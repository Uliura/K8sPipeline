steps:
  - task: DockerInstaller@0
    inputs:
      dockerVersion: '20.10.9'
  
  - script: |
      cp /azp/_work/_tool/docker-stable/20.10.9/x64/docker /usr/bin/docker
      systemctl start docker
    displayName: try to run docker

  - task: Docker@2
    displayName: Build and push an image to container registry
    inputs:
      containerRegistry: $(dockerRegistryServiceConnection)
      repository: $(imageRepository)
      command: 'buildAndPush'
      Dockerfile: $(dockerfilePath)
      tags: $(tag)
  
  - task: PublishPipelineArtifact@1
    inputs:
      artifactName: 'manifests'
      path: 'manifests'